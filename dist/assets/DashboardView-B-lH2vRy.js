import{u as F,x as R,l as T,c as b,a as l,b as t,d as h,w as k,h as g,R as _,f as u,F as y,n as w,o as d,t as o}from"./index-K87GO5ZW.js";import{u as D}from"./blog-CwRy5bNt.js";const N={class:"space-y-8"},V={class:"flex flex-wrap items-center justify-between gap-4"},B={class:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900"},j={class:"space-y-4"},L={class:"mt-6 space-y-3"},S={key:0,class:"text-xs text-slate-400 dark:text-slate-500"},z={key:1,class:"space-y-2 text-sm text-slate-600 dark:text-slate-300"},E={class:"min-w-0 flex-1"},I={class:"truncate font-medium text-slate-700 dark:text-slate-200"},P={class:"text-[11px] text-slate-400"},U={class:"flex flex-shrink-0 items-center gap-2"},$=["onClick"],q={class:"grid gap-6 lg:grid-cols-2"},G={class:"text-lg font-semibold text-slate-900 dark:text-slate-100"},H={class:"mt-1 text-xs text-slate-400"},J={class:"flex flex-wrap gap-3 text-sm text-slate-600 dark:text-slate-300"},K={class:"rounded-full bg-primary/10 px-3 py-1 font-medium text-primary"},O={class:"rounded-full bg-emerald-100 px-3 py-1 font-medium text-emerald-600 dark:bg-emerald-500/10 dark:text-emerald-300"},Q={class:"rounded-full bg-amber-100 px-3 py-1 font-medium text-amber-600 dark:bg-amber-500/10 dark:text-amber-300"},W={class:"space-y-2"},X={key:0,class:"text-xs text-slate-400"},Y={key:1,class:"rounded-2xl bg-slate-100/70 p-3 text-xs text-slate-600 dark:bg-slate-800/60 dark:text-slate-300"},Z={class:"font-medium"},tt={class:"mt-1 leading-relaxed"},et={class:"mt-2 text-[11px] text-slate-400"},ot={__name:"DashboardView",setup(st){const c=F(),n=D(),i=T();R(()=>{c.isAuthor||i.replace({name:"home"})});const v=b(()=>n.articles.map(a=>{const s=n.getArticleStats(a.slug),e=n.getComments(a.slug);return{...a,stats:s,latestComment:e[0]||null}})),x=b(()=>n.customArticles),p=a=>{if(!a)return"";try{const e=/T\d/.test(a)?{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}:{year:"numeric",month:"short",day:"numeric"};return new Intl.DateTimeFormat("zh-CN",e).format(new Date(a))}catch{return a}},A=a=>new Promise((s,e)=>{const r=new FileReader;r.onload=()=>s(r.result),r.onerror=e,r.readAsText(a,"utf-8")}),C=async a=>{var e,r;const s=(r=(e=a.target)==null?void 0:e.files)==null?void 0:r[0];if(a.target.value="",!(!s||!c.isAuthor))try{const m=await A(s),f=n.importMarkdownArticle({fileName:s.name,content:String(m)});f&&i.push({name:"article",params:{slug:f.slug}})}catch(m){console.warn("读取 Markdown 失败",m)}},M=a=>{var r;if(!c.isAuthor||!window.confirm("确定删除这篇文章吗？操作不可撤销。"))return;n.deleteArticle(a)&&i.currentRoute.value.name==="article"&&((r=i.currentRoute.value.params)==null?void 0:r.slug)===a&&i.push({name:"home"})};return(a,s)=>(d(),l("div",N,[t("header",V,[s[1]||(s[1]=t("div",null,[t("p",{class:"text-xs uppercase tracking-widest text-primary/80"},"作者后台"),t("h1",{class:"text-2xl font-semibold text-slate-900 dark:text-slate-100"},"互动概览"),t("p",{class:"mt-1 text-sm text-slate-500 dark:text-slate-400"}," 在这里可以查看每篇文章的点赞、收藏、评论情况，并维护自定义 Markdown 文章。 ")],-1)),h(g(_),{to:"/",class:"inline-flex items-center rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:border-primary hover:text-primary dark:border-slate-800 dark:text-slate-300"},{default:k(()=>[...s[0]||(s[0]=[u(" 返回前台 ",-1)])]),_:1})]),t("section",B,[t("div",j,[s[2]||(s[2]=t("div",null,[t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100"},"上传文章"),t("p",{class:"mt-1 text-xs text-slate-500 dark:text-slate-400"}," 上传 Markdown 文件即可生成新的文章，支持携带 Front Matter 元数据。 ")],-1)),t("input",{type:"file",accept:".md,.markdown,text/markdown",onChange:C,class:"block w-full cursor-pointer rounded-2xl border border-dashed border-slate-300 bg-white px-4 py-3 text-xs text-slate-500 transition focus:border-primary focus:outline-none dark:border-slate-700 dark:bg-slate-950"},null,32),s[3]||(s[3]=t("p",{class:"text-[11px] text-slate-400 dark:text-slate-500"},[u(" 示例 Front Matter："),t("code",null,"--- title: 我的文章 tags: [Vue3, 随笔] ---")],-1))]),t("div",L,[s[5]||(s[5]=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-sm font-semibold text-slate-700 dark:text-slate-200"},"自定义文章"),t("p",{class:"text-xs text-slate-400 dark:text-slate-500"},"本地存储，不会上传服务器")],-1)),x.value.length?(d(),l("ul",z,[(d(!0),l(y,null,w(x.value,e=>(d(),l("li",{key:e.slug,class:"flex items-center justify-between gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 dark:border-slate-800 dark:bg-slate-900"},[t("div",E,[t("p",I,o(e.title),1),t("p",P,o(e.slug)+" · "+o(p(e.date)),1)]),t("div",U,[h(g(_),{to:{name:"article",params:{slug:e.slug}},class:"rounded-full border border-primary/40 px-3 py-1 text-[11px] font-medium text-primary hover:bg-primary/10"},{default:k(()=>[...s[4]||(s[4]=[u(" 查看 ",-1)])]),_:1},8,["to"]),t("button",{type:"button",class:"rounded-full border border-red-200 px-3 py-1 text-[11px] font-medium text-red-500 transition hover:bg-red-50 dark:border-red-500/40 dark:text-red-300 dark:hover:bg-red-500/10",onClick:r=>M(e.slug)}," 删除 ",8,$)])]))),128))])):(d(),l("p",S," 暂无自定义文章，上传 Markdown 后会出现在此处。 "))])]),t("section",q,[(d(!0),l(y,null,w(v.value,e=>(d(),l("article",{key:e.slug,class:"space-y-4 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900"},[t("div",null,[t("h2",G,o(e.title),1),t("p",H,"发布时间："+o(e.date),1)]),t("div",J,[t("span",K,"点赞 "+o(e.stats.likes),1),t("span",O,"收藏 "+o(e.stats.favorites),1),t("span",Q,"评论 "+o(e.stats.comments),1)]),t("div",W,[s[6]||(s[6]=t("h3",{class:"text-sm font-semibold text-slate-700 dark:text-slate-200"},"最新评论",-1)),e.latestComment?(d(),l("div",Y,[t("p",Z,o(e.latestComment.author),1),t("p",tt,o(e.latestComment.content),1),t("p",et,o(p(e.latestComment.createdAt)),1)])):(d(),l("p",X,"暂无评论"))])]))),128))])]))}};export{ot as default};
